# Presence notification
- id: PRE001
  alias: Presence Notification Home
  trigger:
    platform: state
    entity_id: person.julien, person.mojca, person.mia, person.evy
    to: 'home'
  action:
  - service: notify.ju
    data_template:
      title: 'Presence Notification'
      message: >
        {{ trigger.from_state.attributes.friendly_name }} est Ã  la maison.

- id: PRE002
  alias: Presence Notification Leave
  trigger:
    platform: state
    entity_id: person.julien, person.mojca, person.mia, person.evy
    from: 'home'
  action:
  - service: notify.ju
    data_template:
      title: 'Presence Notification'
      message: >
        {{ trigger.from_state.attributes.friendly_name }} est parti.

- id: PRE003
  alias: Presence Workaround to prevent device to be away if door not opened
  trigger:
    platform: state
    entity_id: device_tracker.b0_19_c6_b4_82_2f
    from: 'home'
  condition:
  - condition: template
    value_template: '{{ as_timestamp(now()) - as_timestamp(states.binary_sensor.door_window_sensor_158d0002c9c949.attributes.last_triggered) | int > 600 }}'
  action:
  - service: device_tracker.see
    data:
      dev_id: device_tracker.b0_19_c6_b4_82_2f
      location_name: 'home'
  - service: notify.ju
    data_template:
      title: 'Presence Workaround'
      message: >
        {{ trigger.from_state.attributes.friendly_name }} est remis en home car porte pas ouverte recemment


  # - service: tts.google_say
  #   entity_id: media_player.cuisine
  #   data_template:
  #     message: >
  #       {%- macro speak_presence(person) -%}
  #         {{ [
  #         "A bientot " + person + " !",
  #         person + "est parti !",
  #         person + "n'est plus la !"
  #         ] | random }}
  #       {%- endmacro -%}
  #       {% set person = trigger.from_state.attributes.friendly_name %}       
  #       {{ speak_presence(person) }}

# - alias: Turn off air purifier when everyone leaves
#   trigger: 
#     platform: state
#     entity_id: group.allpersons
#     to: 'not_home'
#   action:
#     entity_id: fan.air_purifier
#     service: fan.turn_off