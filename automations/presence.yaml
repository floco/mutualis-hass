# Presence notification
- id: A018a
  alias: Presence Notification Home
  trigger:
    platform: state
    entity_id: person.julien, person.mojca, person.mia, person.evy
    to: 'home'
  action:
  - service: notify.ju
    data_template:
      title: 'Presence Notification'
      message: >
        {{ trigger.from_state.attributes.friendly_name }} est à la maison.
  - service: tts.google_say
    entity_id: media_player.cuisine
    data_template:
      message: >
        {%- macro speak_presence(person) -%}
          {{ [
          "Bienvenue " + person + " !",
          "Salut à toi " + person + " !",
          "Bonjour " + person + " !"
          ] | random }}
        {%- endmacro -%}
        {% set person = trigger.from_state.attributes.friendly_name %}       
        {{ speak_presence(person) }}

- id: A018b
  alias: Presence Notification Leave
  trigger:
    platform: state
    entity_id: person.julien, person.mojca, person.mia, person.evy
    from: 'home'
  action:
  - service: notify.ju
    data_template:
      title: 'Presence Notification'
      message: >
        {{ trigger.from_state.attributes.friendly_name }} est parti.
  - service: tts.google_say
    entity_id: media_player.cuisine
    data_template:
      message: >
        {%- macro speak_presence(person) -%}
          {{ [
          "A bientot " + person + " !",
          person + "est parti !",
          person + "n'est plus la !"
          ] | random }}
        {%- endmacro -%}
        {% set person = trigger.from_state.attributes.friendly_name %}       
        {{ speak_presence(person) }}

#

# - alias: Turn off air purifier when everyone leaves
#   trigger: 
#     platform: state
#     entity_id: group.allpersons
#     to: 'not_home'
#   action:
#     entity_id: fan.air_purifier
#     service: fan.turn_off