# Belgacom TV
belgacom_tv:
  alias: Belgacom TV
  sequence:
    - service: broadlink.send
      data:
        host: !secret broadlink_rm_host 
        packet:
          - 'JgCuAC8RFxEIF0ITBw0HEiQXFwALcy8RFxEIF0ITBw0HEiQXFwALdB8GCRIHBgkTBhcIBhcHCAYIFAUPBRQGCAcGCRcHBgkAC3UeBgkSBwYJEgcYBwYJBggGCQYIFAUPBRQGCAcGCRgGBwgAC3UeBgkSBwcIEwYYFgYJBQkGCRMHDQcSJRcGCAgAC3QuEhUTBxhCEgcMCBIlFxYAC3QuEhYSBxgzEwcSBw0HEiUYFQANBQAAAAAAAAAAAAA'
          - 'JgCgABEGCAYJEwYHCBMGGAcHCAYXBgkSBw4FFAYHCAYJGAYHCAALdS4SFhIIF0IRCA0HEiQYFgALdC4SFhIIF0ISBw0HEiUXFgALdC4SFhIIF0ISBw0HEiUXFgALdC4SFhIIF0ISCAwHEiUXFwALcy4SCAUJEggXQhIIDAgRJRcXAAtzLhMGCAgSBhgWBgkGCRIGFAYOBRQGCAgFCRgGCAcADQUAAAAAAAAAAA=='
          - 'JgCqAC4SFhIIF0IRCA0HEyQXFgALdC4SFhIIF0ISBw0HEiUXFwALcy4SFhMGGAgFNRIIDAgRJRcXAAtzLhIWEggXQhIIDQcRJRcXAAtzIAYJEgYHCRIHGAYHCQUJBgkGCBMGDwUTBwcIBQkYBwcIAAt0EAYJBgkSBggIEgcYBwcIBQkGCQYIEwYPBRMHBwgGCBgHBwgAC3UQBRkRFxEIFzQRCBIIDQcRJRcXAA0FAAAAAAAAAAAAAAAAAAA'

# Sharp TV
source_ext4:
  alias: Source ext4
  sequence:
    - service: broadlink.send
      data:
        host: !secret broadlink_rm_host 
        packet:
          - 'JgDMAAw6CxgLFwwXCzoKGQoYDDkLGAs6CzoLOws6DDkLFwsABYkMOgwXCxcLFws7CzoLOgsXCzoNFgsYChgLGAoYCzoLAAXPDDkMFwsXCxgLOgsXCxgLOgsXCzsMOQs6DDkLOgwXCwAFigw5CxcLGAsXCzoLOgs7DBYLOwwWDBcLFwsXCxgLOgwABc0MOgwXDBYMFws6CxgLFws6CxgLOgs6CzsLOgs6DBYLAAWJDDoMFwsWCxgLOws6DDkLFww5DRYLGAoYCxgLFws6CwANBQAAAAAAAAAAAAAAAA=='
source_ext5:
  alias: Source ext5
  sequence:
    - service: broadlink.send
      data:
        host: !secret broadlink_rm_host 
        packet:
          - 'JgDMAAs6CxcLGAsXCzoLOgsYCzsMFgw5DDkLOwo7CjwLFgsABWcNOAwXCxgLFws6CxgLOgsXCzoLGAsXCxgLFwsYCzoMAAXwCzsMFwsXCxcLOww5CxcMOQsYCzoLOgs7DDkMOQsYCgAFZww5CxgKGAsYCjsLFws7DBYLOwsXDBcLFwsXCxcKPAwABfEMOQsXCxgLFws6CzoLGAs6CxgKOww5DDoKOws6CxcLAAVmDDoMFwwXChgLOgsYCzoLFws6ChkLFwsYCxcLGAo7CwANBQAAAAAAAAAAAAAAAA=='
source_ext6:
  alias: Source ext6
  sequence:
    - service: broadlink.send
      data:
        host: !secret broadlink_rm_host 
        packet:
          - 'JgDMAA44DBcKGAwXCzoMFgsYCxgKOws6CD0KOwk9DDkLFwwABYgJPAoZCBoKGQg9CjwLOgk8ChgKGQkZCxgKGAwXCzoJAAXRCjsLFwkaCxcKOwwXCxcJGgk8CTwLOww5CzoLOgkaCwAFiQo8ChgKGQsXCzoKOwo7DDoMFwsWChkKGAwXCxcKPAoABc8NOQwXDBYMFgs7DBYMFwwWCzsLOgs6CzoMOg43DBYPAAWFETQMFwsXCxgKOww6DzYONwsXChkLFwsYDBYLGAs6CwANBQAAAAAAAAAAAAAAAA=='

# Portta
portta:
  alias: Portta
  sequence:
    - service: broadlink.send
      data:
        host: !secret broadlink_rm_host 
        packet:
          - 'JgBcABUACxYAASiQFBEVEBUQExEVEBUQExEVEBU0FTQUNRY0FTQUNRY0FTQUERUPFg8UERUPFhATERUPFjMWNBQ1FTQWNBQ1FjMWNBQABRMAASdIFQAMOwABKEcVAA0FAAAAAAAAAAAAAAAA'

# chromecast input
input1:
  alias: Input 1
  sequence:
    - service: broadlink.send
      data:
        host: !secret broadlink_rm_host 
        packet:
          - 'JgBgAAABKJAWDhUQFRAVDxUQFRAVDxUQFTQWNBU0FTQXMxU0FTQWNBUPFRAVEBU0FRAUEBUQFRAVNBU0FTQVEBU0FjMVNRU0FQAFEgABKEcVAAw6AAEoRhYADDoAAShGFgANBQAAAAAAAAAA'

# apple tv input
input2:
  alias: Input 2
  sequence:
    - service: broadlink.send
      data:
        host: !secret broadlink_rm_host 
        packet:
          - 'JgBgAAABKJAWDhUQFRAVDxUQFRAVDxUQFTQWNBU0FTQWNBQ1FTQVNRQQFTQVEBU0FRAVDxUQFRAVNBUQFDUVEBU0FTQVNBY0FQAFEgABKEYWAAw6AAEoRhYADDgAASpGFgANBQAAAAAAAAAA'

# ps3 input
input3:
  alias: Input 3
  sequence:
    - service: broadlink.send
      data:
        host: !secret broadlink_rm_host 
        packet:
          - 'JgBgAAABJZMSEhQRFBESEhQRFBEQFBQREzYUNhE4FDUUNhI3FDUUNhISFRATNhQ0FREVDxMSFRAVNBU0FBEVEBU0FTQTNhY0FQAFEgABKEYWAAw6AAEnRxUADDoAAShGFgANBQAAAAAAAAAA'

# tv input
input4:
  alias: Input 4
  sequence:
    - service: broadlink.send
      data:
        host: !secret broadlink_rm_host 
        packet:
          - 'JgBgAAABKJAWDxQQFRAVEBQQFRAVEBQQFTQWNBU0FjMXMxU0FjMWNBUPFTUUNRU0Fg8VEBUPFRAVNBYPFRAUEBU0FjMWNBU0FQAFEgABKEcVAAw6AAEoRhYADDoAAShGFgANBQAAAAAAAAAA'

# Activities
watch_tv:
  sequence:
    - service: homeassistant.turn_off
      entity_id: switch.prise1
    - service: homeassistant.turn_on
      entity_id: switch.mp1_sha
    - service: homeassistant.turn_on
      entity_id: switch.mp1_btv
    - service: homeassistant.turn_off
      entity_id: switch.mp1_atv
    - service: homeassistant.turn_off
      entity_id: switch.mp1_ps3
    - service: homeassistant.turn_on
      entity_id: switch.prise1
    - delay: 00:00:03
    - service: homeassistant.turn_on
      entity_id: switch.sharp
    - service: homeassistant.turn_on
      entity_id: script.source_ext5
    - service: homeassistant.turn_on
      entity_id: script.input4
    - service: homeassistant.turn_on
      entity_id: switch.bose_system
    - delay: 00:00:40
    - service: homeassistant.turn_on
      entity_id: script.input4

watch_movies:
  sequence:
    - service: homeassistant.turn_off
      entity_id: switch.prise1
    - service: homeassistant.turn_on
      entity_id: switch.mp1_sha
    - service: homeassistant.turn_on
      entity_id: switch.mp1_atv
    - service: homeassistant.turn_off
      entity_id: switch.mp1_ps3
    - service: homeassistant.turn_on
      entity_id: switch.prise1
    - delay: 00:00:03
    - service: homeassistant.turn_on
      entity_id: switch.sharp
    - service: homeassistant.turn_on
      entity_id: script.source_ext5
    - service: homeassistant.turn_on
      entity_id: script.input2
    - service: homeassistant.turn_on
      entity_id: switch.bose_system
    - delay: 00:00:40
    - service: homeassistant.turn_on
      entity_id: script.input2

watch_ps3:
  sequence:
    - service: homeassistant.turn_off
      entity_id: switch.prise1
    - service: homeassistant.turn_on
      entity_id: switch.mp1_sha
    - service: homeassistant.turn_off
      entity_id: switch.mp1_atv
    - service: homeassistant.turn_on
      entity_id: switch.mp1_ps3
    - service: homeassistant.turn_on
      entity_id: switch.prise1
    - delay: 00:00:03
    - service: homeassistant.turn_on
      entity_id: switch.sharp
    - service: homeassistant.turn_on
      entity_id: script.source_ext5
    - service: homeassistant.turn_on
      entity_id: script.input3
    - service: homeassistant.turn_on
      entity_id: switch.bose_system
    - service: homeassistant.turn_on
      entity_id: switch.ps3_wol
    - delay: 00:00:40
    - service: homeassistant.turn_on
      entity_id: script.input3

listen_audio:
  sequence:
    - service: homeassistant.turn_off
      entity_id: switch.prise1
    - service: homeassistant.turn_off
      entity_id: switch.mp1_sha
    - service: homeassistant.turn_on
      entity_id: switch.prise1
    - delay: 00:00:03
    - service: homeassistant.turn_on
      entity_id: script.input1
    - service: homeassistant.turn_on
      entity_id: switch.bose_system

watch_video:
  sequence:
    - service: homeassistant.turn_off
      entity_id: switch.prise1
    - service: homeassistant.turn_on
      entity_id: switch.mp1_sha
    - service: homeassistant.turn_on
      entity_id: switch.prise1
    - delay: 00:00:03
    - service: homeassistant.turn_on
      entity_id: switch.sharp
    - service: homeassistant.turn_on
      entity_id: script.source_ext5
    - service: homeassistant.turn_on
      entity_id: script.input1
    - service: homeassistant.turn_on
      entity_id: switch.bose_system

stop_watching:
  sequence:
    - service: homeassistant.turn_off
      entity_id: script.bose_system
    - service: homeassistant.turn_off
      entity_id: switch.sharp
    - service: homeassistant.turn_off
      entity_id: script.portta
    - service: homeassistant.turn_off
      entity_id: switch.mp1_sha
    - service: homeassistant.turn_off
      entity_id: switch.mp1_btv
    - service: homeassistant.turn_off
      entity_id: switch.mp1_atv
    - service: homeassistant.turn_off
      entity_id: switch.mp1_ps3
    - service: homeassistant.turn_off
      entity_id: switch.prise1

go_to_sleep:
  alias: Go to sleep
  sequence:
    - service: homeassistant.turn_off
      entity_id: script.everything
    - service: homeassistant.turn_off
      entity_id: switch.lights_outside
    - service: homeassistant.turn_off
      entity_id: light.background
    - service: homeassistant.turn_off
      entity_id: switch.lights_outside

do_nothing:
  sequence:
    - delay: 00:00:01

netatmo:
  sequence:
    - service: homeassistant.turn_on
      entity_id: script.increase_volume
    - service: tts.google_say
      entity_id: media_player.google_home
    #- service: notify.google_assistant
      data_template:
        message: "Il fait {{states('sensor.netatmo_outside_temperature')}} degrés à l'extérieur et {{states('sensor.netatmo_inside_temperature')}} degré à l'interieur. Le niveau de CO2 est de {{states('sensor.netatmo_inside_co2')}} ppm. Bonne journée !"
        # cache: false
    - service: homeassistant.turn_on
      entity_id: script.decrease_volume
    - service: notify.ju
      data_template:
        title: "Netatmo Info"
        message: "Il fait <b>{{states('sensor.netatmo_outside_temperature')}}</b> degrés à l'extérieur et <b>{{states('sensor.netatmo_inside_temperature')}}</b> degré à l'interieur. Le niveau de CO2 est de <b>{{states('sensor.netatmo_inside_co2')}}</b> ppm. Bonne journée !"

notify_all:
  sequence:
    - service: notify.ju
      data_template:
        title: "{{ title }}"
        message: "{{ message }}"
    - service: notify.mo
      data_template:
        title: "{{ title }}"
        message: "{{ message }}"

#Inspiration: https://github.com/CCOSTAN/Home-AssistantConfig/blob/master/script/speech_engine.yaml

table_up:
  sequence:
    - service: homeassistant.turn_on
      entity_id: script.table
      data:
        variables:
          action: 'mettre'

table_down:
  sequence:
    - service: homeassistant.turn_on
      entity_id: script.table
      data:
        variables:
          action: 'débarasser'

table:
  sequence:
    - service: homeassistant.turn_on
      entity_id: script.increase_volume
    - service: tts.google_say
      entity_id: media_player.google_home
    #- service: notify.google_assistant
      data_template:
        message: >
          {%- macro speak_table(person,action) -%}
            {{ [
            "Allez on se bouge, cette semaine c'est a " + person + " de " + action + " la table ! Merci " + person + "!",
            "Cette semaine c'est a " + person + " de " + action + " la table ! Merci " + person + "!",
            person + ", c'est a ton tour de " + action + " la table ! Merci " + person + "!",
            "Dis donc " + person + " ce serait pas a toi de " + action + " la table par hasard ? Merci " + person + "!",
            "Alors ma grande, t'a oubliée de" + action + " la table." + person + ", on se depeche ! Allez " + person
            ] | random }}
          {%- endmacro -%}
          {% if now().strftime("%W")|int % 2 != 0 %}
            {% if action == "mettre" %}
              {% set person = "Evy" %}
            {% else %}
              {% set person = "Mia" %}
            {%endif%}
          {% else %}
            {% if action == "mettre" %}
              {% set person = "Mia" %}
            {% else %}
              {% set person = "Evy" %}
            {%endif%}
          {%endif%}
          {{ speak_table(person,action) }}
    - service: homeassistant.turn_on
      entity_id: script.decrease_volume

garbage:
  sequence:
    - service: homeassistant.turn_on
      entity_id: script.increase_volume
    - service: tts.google_say
      entity_id: media_player.google_home
    #- service: notify.google_assistant
      data_template:
        message: >
          {%- macro speak_garbage() -%}
            {{ [
            "Oublies pas de sortir la poubelle, merci !",
            "C'est le jour des poubelles, merci !"
            ] | random }}
          {%- endmacro -%}
          {{ speak_garbage() }}
    - service: homeassistant.turn_on
      entity_id: script.decrease_volume

cleaning:
  sequence:
    - service: homeassistant.turn_on
      entity_id: script.increase_volume
    - service: tts.google_say
      entity_id: media_player.google_home
    #- service: notify.google_assistant
      data_template:
        message: >
          {%- macro speak_cleaning() -%}
            {{ [
            "Prepares tout ce qu'il faut pour Fatima !",
            "Oublies pas Fatima !"
            ] | random }}
          {%- endmacro -%}
          {{ speak_cleaning() }}
    - service: homeassistant.turn_on
      entity_id: script.decrease_volume

doorbell:
  sequence:
    - service: xiaomi_aqara.play_ringtone
      data:
        gw_mac: !secret xiaomi_gw_mac
        ringtone_id: 10001
        ringtone_vol: 100
    - service: homeassistant.turn_on
      entity_id: script.increase_volume_doorbell
    - service: media_player.play_media
      data_template:
        entity_id: media_player.google_home
        media_content_id: !secret ring_chime
        media_content_type: music
    - service: homeassistant.turn_on
      entity_id: script.decrease_volume

alarm_on:
  sequence:
    - service: xiaomi_aqara.play_ringtone
      data:
        gw_mac: !secret xiaomi_gw_mac
        ringtone_id: 1
        ringtone_vol: 100
    - service: notify.ju
      data_template:
        title: Alarm Triggered... 
        message: >         
          {% if states('binary_sensor.door_window_sensor_158d000232b0ad') == "on" %} 
          Fenetre_Parents
          {% endif %}
          {% if states('binary_sensor.door_window_sensor_158d000237d1e8') == "on" %} 
          Fenetre_Mia_Devant
          {% endif %}
          {% if states('binary_sensor.door_window_sensor_158d000238c840') == "on" %} 
            Fenetre_Mia_Laterale
          {% endif %}
          {% if states('binary_sensor.door_window_sensor_158d00023295ce') == "on" %} 
            Fenetre_Evy
          {% endif %}
          {% if states('binary_sensor.door_window_sensor_158d000237d247') == "on" %} 
            Velux_Evy
          {% endif %}
          {% if states('binary_sensor.door_window_sensor_158d000238628c') == "on" %} 
            Fenetre_Chambre_Amis
          {% endif %}
          {% if states('binary_sensor.door_window_sensor_158d000237d1b8') == "on" %} 
            Fenetre_Upstairs
          {% endif %}
          {% if states('binary_sensor.door_window_sensor_158d000243645e') == "on" %} 
            Velux_Salle_de_bain
          {% endif %}
          <b>Opened</b>
    - service: homeassistant.turn_on
      entity_id: light.gateway_light_7811dcb8f98a
      data:
        brightness: 255
        rgb_color: [254,0,0]

alarm_off:
  sequence:
    - service: xiaomi_aqara.play_ringtone
      data:
        gw_mac: !secret xiaomi_gw_mac
        ringtone_id: 10003
        ringtone_vol: 10     
    - service: script.blink_green

alarm_armed:
  sequence:
    - service: xiaomi_aqara.play_ringtone
      data:
        gw_mac: !secret xiaomi_gw_mac
        ringtone_id: 10002
        ringtone_vol: 10  
    - service: script.blink_orange

smoke_alarm:
  sequence:
    - service: xiaomi_aqara.play_ringtone
      data:
        gw_mac: !secret xiaomi_gw_mac
        ringtone_id: 2
        ringtone_vol: 100
    - service: notify.ju
      data_template:
        title: Smoke Alarm Triggered... 
        message: >         
          {% if states('binary_sensor.smoke_sensor_158d0001bbe483') == "on" %} 
          Smoke_Sensor_Upstairs
          {% endif %}
          {% if states('binary_sensor.smoke_sensor_158d0001e581ee') == "on" %} 
          Smoke_Sensor_Living
          {% endif %}
          <b>detected a fire !</b>
    - service: homeassistant.turn_on
      entity_id: light.gateway_light_7811dcb8f98a
      data:
        brightness: 255
        rgb_color: [254,0,0]

# Common scripts
increase_volume_max:
  sequence:
    - service: media_player.volume_set
      data:
        entity_id: media_player.google_home
        volume_level: 1.0

increase_volume_doorbell:
  sequence:
    - service: media_player.volume_set
      data:
        entity_id: media_player.google_home
        volume_level: 0.8

increase_volume:
  sequence:
    - service: media_player.volume_set
      data:
        entity_id: media_player.google_home
        volume_level: 0.5

decrease_volume:
  sequence:
    - delay: 00:00:15
    - service: media_player.volume_set
      data:
        entity_id: media_player.google_home
        volume_level: 0.4

blink_green:
  sequence:
    - service: script.light_green
    - wait_template: "{{ is_state('script.light_green', 'off') }}"
    - service: script.light_green
    - wait_template: "{{ is_state('script.light_green', 'off') }}"

light_green:
  sequence:
    - service: homeassistant.turn_on
      entity_id: light.gateway_light_7811dcb8f98a
      data:
        brightness: 255
        rgb_color: [0,254,0]
    - delay: 00:00:01
    - service: homeassistant.turn_off
      entity_id: light.gateway_light_7811dcb8f98a
    - delay: 00:00:01

blink_orange:
  sequence:
    - service: script.light_orange
    - wait_template: "{{ is_state('script.light_orange', 'off') }}"
    - service: script.light_orange
    - wait_template: "{{ is_state('script.light_orange', 'off') }}"
    - service: script.light_orange
    - wait_template: "{{ is_state('script.light_orange', 'off') }}"
    - service: script.light_orange
    - wait_template: "{{ is_state('script.light_orange', 'off') }}"   

light_orange:
  sequence:
    - service: homeassistant.turn_on
      entity_id: light.gateway_light_7811dcb8f98a
      data:
        brightness: 255
        rgb_color: [0,0,254]
    - delay: 00:00:01
    - service: homeassistant.turn_off
      entity_id: light.gateway_light_7811dcb8f98a
    - delay: 00:00:01

door_alert:
  sequence:
    - service: notify.ju
      data_template:
        title: Main door opened ... 
        message: >         
          <b>door opened !</b>

home_enter:
  sequence:
    - service: notify.ju
      data_template:
        title: Welcome home ... 
        message: >         
          <b>Hello Julien</b>

home_leave:
  sequence:
    - service: notify.ju
      data_template:
        title: Bye bye ... 
        message: >         
          <b>Bye Julien</b>
